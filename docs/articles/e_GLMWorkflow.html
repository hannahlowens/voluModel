<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>5. 3D Niche Modeling with the GLM Algorithm • voluModel</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="5. 3D Niche Modeling with the GLM Algorithm">
<meta property="og:description" content="voluModel">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">voluModel</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a_Introduction.html">1. Introduction to `voluModel`</a>
    </li>
    <li>
      <a href="../articles/b_RasterProcessing.html">2. Processing Raster Data</a>
    </li>
    <li>
      <a href="../articles/c_DataSampling.html">3. Environmental Data Sampling</a>
    </li>
    <li>
      <a href="../articles/d_Visualization.html">4. Visualization Tools</a>
    </li>
    <li>
      <a href="../articles/e_GLMWorkflow.html">5. 3D Niche Modeling with the GLM Algorithm</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hannahlowens/voluModel/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>5. 3D Niche Modeling with the GLM Algorithm</h1>
                        <h4 data-toc-skip class="author">Hannah L.
Owens</h4>
                        <h4 data-toc-skip class="author">Carsten
Rahbek</h4>
            
            <h4 data-toc-skip class="date">2023-04-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/hannahlowens/voluModel/blob/HEAD/vignettes/e_GLMWorkflow.Rmd" class="external-link"><code>vignettes/e_GLMWorkflow.Rmd</code></a></small>
      <div class="hidden name"><code>e_GLMWorkflow.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette, I will focus on demonstrating a basic workflow for
generating and projecting a 3D ecological niche model using a
generalized linear model, incorporating <code>voluModel</code>
tools.</p>
<p>Here are the packages you will need.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://hannahlowens.github.io/voluModel/" class="external-link">voluModel</a></span><span class="op">)</span> <span class="co"># Because of course</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span> <span class="co"># For occurrence data filtration</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'dplyr'</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     filter, lag</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     intersect, setdiff, setequal, union</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span> <span class="co"># For fancy plotting</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/terra/" class="external-link">terra</a></span><span class="op">)</span> <span class="co"># Now being transitioned in</span></span></code></pre></div>
<pre><code><span><span class="co">## terra 1.7.18</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span> <span class="co"># Now being transitioned in</span></span></code></pre></div>
<pre><code><span><span class="co">## Linking to GEOS 3.11.0, GDAL 3.5.1, PROJ 9.0.1; sf_use_s2() is TRUE</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridisLite/" class="external-link">viridisLite</a></span><span class="op">)</span> <span class="co"># For high-contrast plotting palettes</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-inputs">Data Inputs<a class="anchor" aria-label="anchor" href="#data-inputs"></a>
</h2>
<p>First thing’s first. Distributional models are based on coordinates
of species’ occurrences. Here is an example dataset of
<em>Steindachneria argentea</em>, Luminous Hake, using data downloaded
via R (R Core Team, 2020) from GBIF (Chamberlain <em>et al.</em>, 2021;
Chamberlain and Boettiger, 2017) and OBIS (Provoost and Bosch, 2019) via
<code>occCite</code> (Owens <em>et al.</em>, 2021).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">occs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/Steindachneria_argentea.csv"</span>, </span>
<span>                             package<span class="op">=</span><span class="st">'voluModel'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">occs</span><span class="op">$</span><span class="va">depth</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span></span>
<span><span class="co">##     0.0     0.0   117.0   184.9   353.2  2067.5     113</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/grDevices/boxplot.stats.html" class="external-link">boxplot.stats</a></span><span class="op">(</span><span class="va">occs</span><span class="op">$</span><span class="va">depth</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $stats</span></span>
<span><span class="co">## [1]   0.0   0.0 117.0 354.5 676.5</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $n</span></span>
<span><span class="co">## [1] 188</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $conf</span></span>
<span><span class="co">## [1]  76.14978 157.85022</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $out</span></span>
<span><span class="co">## [1] 2067.5</span></span></code></pre>
<p>Based on this information and what we know about the biology of
Luminous Hakes and how these occurrence data are collected, I am going
to remove occurrences that have a depth of 0, as well as the extreme
depth outlier, since these look like either collections of individuals
that were not <em>in situ</em> or errors of some kind.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">occsClean</span> <span class="op">&lt;-</span> <span class="va">occs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">decimalLongitude</span>, <span class="va">decimalLatitude</span>, <span class="va">depth</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html" class="external-link">between</a></span><span class="op">(</span><span class="va">depth</span>, <span class="fl">1</span>, <span class="fl">2000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">occsClean</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   decimalLongitude decimalLatitude  depth</span></span>
<span><span class="co">## 1        -54.90000        7.450000 260.50</span></span>
<span><span class="co">## 2        -54.08333        7.666667 450.00</span></span>
<span><span class="co">## 3        -54.08333        7.666667 450.00</span></span>
<span><span class="co">## 4        -56.87500        7.741667 365.76</span></span>
<span><span class="co">## 5        -80.43333        9.300000  82.00</span></span>
<span><span class="co">## 6        -59.78330        9.683300 274.00</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">occsClean</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>, y<span class="op">=</span><span class="va">depth</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"yellow"</span>, <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Arial"</span><span class="op">)</span>,</span>
<span>        axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">rel</a></span><span class="op">(</span><span class="fl">1.1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Depth"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p><img src="e_GLMWorkflow_files/figure-html/clean%20occurrence%20data-1.png"><!-- --></p>
<p>Next, we load two environmental datasets from the World Ocean Atlas
(Garcia <em>et al.</em>, 2019): temperature (Locarnini <em>et al.</em>,
2018) and apparent oxygen utilization (Garcia <em>et al.</em>, 2019). I
have chosen these variables for simplified illustrative purposes–we
recommend you explore additional variables from the World Ocean Atlas
and other sources. These data are supplied by the World Ocean Atlas as
point shapefiles; the version supplied here has been cropped between
-110 and -40 longitude and between -5 and 50 latitude to make it more
memory-efficient. For more details on how to process environmental data,
see <a href="https://hannahlowens.github.io/voluModel/articles/b_RasterProcessing.html" class="external-link">the
raster data tutorial</a>. Temperature processing is shown below for
illustrative purposes.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Temperature</span></span>
<span><span class="va">td</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/woa18_decav_t00mn01_cropped.zip"</span>, </span>
<span>                  package <span class="op">=</span> <span class="st">"voluModel"</span><span class="op">)</span>,</span>
<span>      exdir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">td</span>, <span class="st">"/temperature"</span><span class="op">)</span>, junkpaths <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">temperature</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">td</span>, <span class="st">"/temperature/woa18_decav_t00mn01_cropped.shp"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Creating a SpatRaster vector</span></span>
<span><span class="va">template</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/centerPointRasterTemplate.html">centerPointRasterTemplate</a></span><span class="op">(</span><span class="va">temperature</span><span class="op">)</span></span>
<span><span class="va">tempTerVal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rasterize.html" class="external-link">rasterize</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">temperature</span>, y <span class="op">=</span> <span class="va">template</span>, field <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">temperature</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get names of depths</span></span>
<span><span class="va">envtNames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"[d,M]"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">temperature</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">envtNames</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"0"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tempTerVal</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">envtNames</span></span>
<span><span class="va">temperature</span> <span class="op">&lt;-</span> <span class="va">tempTerVal</span></span></code></pre></div>
<p>Pre-processed apparent oxygen utilization is loaded from an
<code>.Rdata</code> file for speed.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oxygenSmooth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/oxygenSmooth.tif"</span>, </span>
<span>                                 package<span class="op">=</span><span class="st">'voluModel'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Change names to match temperature</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">oxygenSmooth</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">temperature</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="sampling-data-for-model-generation">Sampling data for model generation<a class="anchor" aria-label="anchor" href="#sampling-data-for-model-generation"></a>
</h2>
<p>The first step is down-sampling the occurrence data so that there is
only one occurrence per voxel (the 3D equivalent of a pixel) of
environmental data. We do this to avoid over-fitting the model due to
biased sampling. The resampled points are centered in each voxel.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Gets the layer index for each occurrence by matching to depth</span></span>
<span><span class="va">layerNames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">temperature</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">occsClean</span><span class="op">$</span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">occsClean</span><span class="op">$</span><span class="va">depth</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html" class="external-link">which.min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">layerNames</span> <span class="op">-</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">occsClean</span><span class="op">$</span><span class="va">index</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Downsamples occsClean in each depth layer</span></span>
<span><span class="va">downsampledOccs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">indices</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">tempPoints</span> <span class="op">&lt;-</span> <span class="va">occsClean</span><span class="op">[</span><span class="va">occsClean</span><span class="op">$</span><span class="va">index</span><span class="op">==</span><span class="va">i</span>,<span class="op">]</span></span>
<span>  <span class="va">tempPoints</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/downsample.html">downsample</a></span><span class="op">(</span><span class="va">tempPoints</span>, <span class="va">temperature</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, </span>
<span>                           verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">tempPoints</span><span class="op">$</span><span class="va">depth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">layerNames</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">tempPoints</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">downsampledOccs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">downsampledOccs</span>, <span class="va">tempPoints</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">occsClean</span> <span class="op">&lt;-</span> <span class="va">downsampledOccs</span></span>
<span></span>
<span><span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Original number of points: "</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">occs</span><span class="op">)</span>, <span class="st">"; number of downsampled occs: "</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">occsClean</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Original number of points: 301; number of downsampled occs: 82"</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">land</span> <span class="op">&lt;-</span> <span class="fu">rnaturalearth</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rnaturalearth/man/ne_countries.html" class="external-link">ne_countries</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="st">"small"</span>, returnclass <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu"><a href="../reference/pointCompMap.html">pointCompMap</a></span><span class="op">(</span>occs1 <span class="op">=</span> <span class="va">occs</span>, occs2 <span class="op">=</span> <span class="va">occsClean</span>, </span>
<span>             occs1Name <span class="op">=</span> <span class="st">"Original"</span>, occs2Name <span class="op">=</span> <span class="st">"Cleaned"</span>, </span>
<span>             spName <span class="op">=</span> <span class="st">"Steindachneria argentea"</span>, </span>
<span>             land <span class="op">=</span> <span class="va">land</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="e_GLMWorkflow_files/figure-html/downsample%20to%20voxel-1.png"><!-- --></p>
<p>Next, we generate a sampling region for the model based on occurrence
points. Note that ideally when you’re modeling you would carefully
curate this background sampling region to make sure it truly
approximates the area accessible to the species you are modeling. If you
write the shapefile to disk, you can open and edit it in any GIS
software you choose, if you have reason to believe
<code><a href="../reference/marineBackground.html">marineBackground()</a></code> falls short of estimating the true
accessible are for a species. For more information, see <a href="https://hannahlowens.github.io/voluModel/articles/c_DataSampling.html" class="external-link">the
environmental data processing tutorial</a>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">backgroundSamplingRegions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/marineBackground.html">marineBackground</a></span><span class="op">(</span><span class="va">occsClean</span>, buff <span class="op">=</span> <span class="fl">1000000</span><span class="op">)</span></span>
<span><span class="va">backgroundSamplingRegions</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">backgroundSamplingRegions</span><span class="op">)</span></span>
<span><span class="va">backgroundSamplingRegions</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">backgroundSamplingRegions</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">land</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">backgroundSamplingRegions</span>, border <span class="op">=</span> <span class="cn">F</span>, col <span class="op">=</span> <span class="st">"gray"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Points and Background Sampling"</span>,</span>
<span>     axes <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">land</span>, col <span class="op">=</span> <span class="st">"black"</span>, add <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">occsClean</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"decimalLongitude"</span>, <span class="st">"decimalLatitude"</span><span class="op">)</span><span class="op">]</span>, </span>
<span>       pch <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="st">"red"</span>, cex <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="PointsAndTrainingRegion.png" width="100%" height="100%"></p>
<p>Finally, we need to draw the environmental variable data that will be
used to generate the ecological niche model, from presence voxels as
well as from the background sampling region. First, we sample
environmental data for occurrences and add a “response” column filled
with 1s, signifying these are considered “presences”.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Presences</span></span>
<span><span class="va">oxyVals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/xyzSample.html">xyzSample</a></span><span class="op">(</span>occs <span class="op">=</span> <span class="va">occsClean</span>, <span class="va">oxygenSmooth</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Using decimalLongitude, decimalLatitude, and depth</span></span>
<span><span class="co">##  as x, y, and z coordinates, respectively.</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tempVals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/xyzSample.html">xyzSample</a></span><span class="op">(</span>occs <span class="op">=</span> <span class="va">occsClean</span>, <span class="va">temperature</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Using decimalLongitude, decimalLatitude, and depth</span></span>
<span><span class="co">##  as x, y, and z coordinates, respectively.</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">occsClean</span>, <span class="va">oxyVals</span>, <span class="va">tempVals</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">vals</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"decimalLongitude"</span>, <span class="st">"decimalLatitude"</span>, <span class="st">"depth"</span>, <span class="st">"AOU"</span>, <span class="st">"Temperature"</span><span class="op">)</span></span>
<span><span class="va">vals</span> <span class="op">&lt;-</span> <span class="va">vals</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">vals</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">vals</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">occsWdata</span> <span class="op">&lt;-</span> <span class="va">vals</span></span>
<span></span>
<span><span class="co"># Add response as a column</span></span>
<span><span class="va">occsWdata</span><span class="op">$</span><span class="va">response</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">occsWdata</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Then, we generate background data by drawing occurrences from the XY
extent of the background shapefile and from user-specified depths from 5
to 800m. Background points intersecting with occurrences are not
returned. Then the environmental data at each background coordinate are
drawn and stored in their own data object, and the “response” column is
added and filled with 0s, signifying that these are to be considered
“absences” when training the model.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Background</span></span>
<span><span class="va">backgroundVals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mSampling3D.html">mSampling3D</a></span><span class="op">(</span>occs <span class="op">=</span> <span class="va">occsClean</span>, </span>
<span>                              envBrick <span class="op">=</span> <span class="va">temperature</span>, </span>
<span>                              mShp <span class="op">=</span> <span class="va">backgroundSamplingRegions</span>, </span>
<span>                              depthLimit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">800</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Using decimalLongitude, decimalLatitude, and depth</span></span>
<span><span class="co">##  as x, y, and z coordinates, respectively.</span></span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oxyVals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/xyzSample.html">xyzSample</a></span><span class="op">(</span>occs <span class="op">=</span> <span class="va">backgroundVals</span>, <span class="va">oxygenSmooth</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Using decimalLongitude, decimalLatitude, and depth</span></span>
<span><span class="co">##  as x, y, and z coordinates, respectively.</span></span></code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tempVals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/xyzSample.html">xyzSample</a></span><span class="op">(</span>occs <span class="op">=</span> <span class="va">backgroundVals</span>, <span class="va">temperature</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Using decimalLongitude, decimalLatitude, and depth</span></span>
<span><span class="co">##  as x, y, and z coordinates, respectively.</span></span></code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">backgroundVals</span>, <span class="va">oxyVals</span>, <span class="va">tempVals</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">vals</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"decimalLongitude"</span>, <span class="st">"decimalLatitude"</span>, <span class="st">"depth"</span>, <span class="st">"AOU"</span>, <span class="st">"Temperature"</span><span class="op">)</span></span>
<span><span class="va">vals</span> <span class="op">&lt;-</span> <span class="va">vals</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">vals</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">vals</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">backgroundWdata</span> <span class="op">&lt;-</span> <span class="va">vals</span></span>
<span></span>
<span><span class="co"># Add response as a column</span></span>
<span><span class="va">backgroundWdata</span><span class="op">$</span><span class="va">response</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">backgroundWdata</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="generalized-linear-model">Generalized linear model<a class="anchor" aria-label="anchor" href="#generalized-linear-model"></a>
</h2>
<p>If you are concerned about overfitting the model because you
generated a lot more background points than presence points, you can
sample from the background data however you think is logical. The
example below samples 100 times the number of occurrence points from the
background, weighted by distance form the suitable centroid of
occurrence points. That is, the more environmentally-different a
background point is from an occurrence point, the more likely it is to
be sampled. This is helpful for GLMs, because background points are
interpreted as “absences” unlike methods like Maxent, where sampling the
most dissimilar background may more likely lead to an overfit model.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sample background points weighted by distance from centroid of occurrence environments</span></span>
<span><span class="va">suitableCentroid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">occsWdata</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Temperature"</span>, <span class="st">"AOU"</span><span class="op">)</span><span class="op">]</span>, </span>
<span>                          MARGIN <span class="op">=</span> <span class="fl">2</span>, FUN <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">backgroundWdata</span><span class="op">$</span><span class="va">distance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">backgroundWdata</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Temperature"</span>, <span class="st">"AOU"</span><span class="op">)</span><span class="op">]</span>, MARGIN <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                                  FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">suitableCentroid</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">backgroundWdata</span><span class="op">$</span><span class="va">sampleWeight</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">backgroundWdata</span><span class="op">$</span><span class="va">distance</span> <span class="op">-</span> </span>
<span>                                 <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">backgroundWdata</span><span class="op">$</span><span class="va">distance</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">backgroundWdata</span><span class="op">$</span><span class="va">distance</span><span class="op">)</span><span class="op">-</span></span>
<span>                                                                 <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">backgroundWdata</span><span class="op">$</span><span class="va">distance</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sampleForAbsence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">backgroundWdata</span><span class="op">)</span>, </span>
<span>                           size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">occsWdata</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, </span>
<span>                           prob <span class="op">=</span> <span class="va">backgroundWdata</span><span class="op">$</span><span class="va">sampleWeight</span><span class="op">)</span></span>
<span><span class="va">backgroundWdata</span> <span class="op">&lt;-</span> <span class="va">backgroundWdata</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">sampleForAbsence</span>, </span>
<span>                                         <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">backgroundWdata</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span></code></pre></div>
<p>Then we unite the presence and absence data into a single data
object.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Unite datasets</span></span>
<span><span class="va">datForMod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">occsWdata</span>, <span class="va">backgroundWdata</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">occsWdata</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">suitableCentroid</span>, <span class="va">sampleForAbsence</span>, <span class="va">backgroundWdata</span>, <span class="va">occsWdata</span><span class="op">)</span></span></code></pre></div>
<p>With the data cleaned, formatted and united into a single
<code>data.frame</code>, generating a generalized linear model is very
simple. How does it look?</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">glmModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">response</span> <span class="op">~</span> <span class="va">Temperature</span> <span class="op">*</span>  <span class="va">AOU</span>, </span>
<span>                  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>,  data <span class="op">=</span> <span class="va">datForMod</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">glmModel</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## glm(formula = response ~ Temperature * AOU, family = binomial(link = "logit"), </span></span>
<span><span class="co">##     data = datForMod)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Deviance Residuals: </span></span>
<span><span class="co">##     Min       1Q   Median       3Q      Max  </span></span>
<span><span class="co">## -0.6996  -0.1578  -0.0797  -0.0550   3.6522  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##                  Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">## (Intercept)     -2.474095   1.331263  -1.858  0.06310 .  </span></span>
<span><span class="co">## Temperature     -0.150006   0.062758  -2.390  0.01684 *  </span></span>
<span><span class="co">## AOU             -0.030234   0.010052  -3.008  0.00263 ** </span></span>
<span><span class="co">## Temperature:AOU  0.003235   0.000691   4.682 2.84e-06 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     Null deviance: 291.73  on 2625  degrees of freedom</span></span>
<span><span class="co">## Residual deviance: 254.13  on 2622  degrees of freedom</span></span>
<span><span class="co">## AIC: 262.13</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Number of Fisher Scoring iterations: 8</span></span></code></pre>
<p>Now we project the model back into geographic space; at this stage,
the niche model is being used to model the geographic distribution of
putative suitable habit for Luminous Hake (an ENM becomes an SDM).</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">layerNames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">temperature</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/match.html" class="external-link">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">datForMod</span><span class="op">$</span><span class="va">depth</span><span class="op">)</span>, <span class="va">layerNames</span><span class="op">)</span>, </span>
<span>             to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/match.html" class="external-link">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">datForMod</span><span class="op">$</span><span class="va">depth</span><span class="op">)</span>, <span class="va">layerNames</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">depthPred</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">index</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">depthPreds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">temperature</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span>, <span class="va">oxygenSmooth</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">depthPreds</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">depthPreds</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Temperature"</span>, <span class="st">"AOU"</span><span class="op">)</span></span>
<span>  <span class="va">depthPred</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/mask.html" class="external-link">mask</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">depthPreds</span>, <span class="va">glmModel</span><span class="op">)</span>, <span class="va">backgroundSamplingRegions</span><span class="op">)</span></span>
<span>  <span class="va">depthPred</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">depthPred</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span>, <span class="va">backgroundSamplingRegions</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">depthPred</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">layerNames</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="va">glmPred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">depthPred</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">depthPred</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>And here’s what the SDM looks like threshholded to presences and
absences; raw ENM suitability values above the threshold value become
presences, values below the threshold become absences. This is useful in
a variety of applications, including, but not limited to visualizing the
model. In this case, the threshold is the bottom tenth percentile of
suitability scores at occurrences. What this means is that we are
interpreting about 10% of the occurrence points to be erroneous. It is
important to remember that there are MANY different thresholds you may
choose based on your dataset and the goals of your analysis. Try to
choose wisely.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">glmThreshold</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="../reference/xyzSample.html">xyzSample</a></span><span class="op">(</span><span class="va">datForMod</span><span class="op">[</span><span class="va">datForMod</span><span class="op">$</span><span class="va">response</span> <span class="op">==</span> <span class="fl">1</span>,</span>
<span>                                             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"depth"</span>, <span class="st">"decimalLongitude"</span>, <span class="st">"decimalLatitude"</span><span class="op">)</span><span class="op">]</span>, </span>
<span>                                   <span class="va">glmPred</span><span class="op">)</span>, <span class="fl">.1</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="co"># MS90</span></span></code></pre></div>
<pre><code><span><span class="co">## Using decimalLongitude, decimalLatitude, and depth</span></span>
<span><span class="co">##  as x, y, and z coordinates, respectively.</span></span></code></pre>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">glmThresholded</span> <span class="op">&lt;-</span> <span class="va">glmPred</span> <span class="op">&gt;</span> <span class="va">glmThreshold</span></span>
<span><span class="va">rclMatrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">0</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">glmThresholded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/classify.html" class="external-link">classify</a></span><span class="op">(</span><span class="va">glmThresholded</span>, <span class="va">rclMatrix</span>, include.lowest <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="../reference/plotLayers.html">plotLayers()</a></code> plots a transparent layer of suitable
habitat for each depth layer. The redder the color, the shallower the
layer, the bluer, the deeper. The more saturated the color, the more
layers with suitable habitat. Here, I am plotting suitability from 0m to
800m, the depth range of occurrences used to train the envelope
model.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotLayers.html">plotLayers</a></span><span class="op">(</span><span class="va">glmThresholded</span>, </span>
<span>          land <span class="op">=</span> <span class="va">land</span>, landCol <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>          title <span class="op">=</span> <span class="st">"Areas of suitable habitat for \n Luminous Hake, 5m to 800m"</span><span class="op">)</span></span></code></pre></div>
<p><img src="e_GLMWorkflow_files/figure-html/thresholded%20glm%20niche%20model%20plotted-1.png"><!-- --></p>
<p>Of course, this just a starting example. We welcome submissions from
the community for examples of other types of models you would like to
see. Submit your suggestions as issues <a href="https://github.com/hannahlowens/voluModel/issues" class="external-link">here</a>.</p>
</div>
<div class="section level2">
<h2 id="cropping-out-extreme-extrapolation">Cropping out extreme extrapolation<a class="anchor" aria-label="anchor" href="#cropping-out-extreme-extrapolation"></a>
</h2>
<p>Sometimes ecological models fail to extrapolate realistically when
they are projected into environments that are not well-represented by
the set of conditions used to calibrate the model (Owens <em>et al</em>,
2013). One convenient way to estimate extrapolation is via the
Multivariate Environmental Suitability Surface (MESS; Elith <em>et
al</em>. 2010). <code>voluModel</code> has a function,
<code><a href="../reference/MESS3D.html">MESS3D()</a></code>, which calculates MESS for each depth layer in a
projection dataset (supplied to the function as a named list of
<code>RasterBrick</code> objects used for the model projection).</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Prepare environmental data</span></span>
<span><span class="va">layerNames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">temperature</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">datForMod</span><span class="op">$</span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">datForMod</span><span class="op">$</span><span class="va">depth</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html" class="external-link">which.min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">layerNames</span> <span class="op">-</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">datForMod</span><span class="op">$</span><span class="va">index</span><span class="op">)</span></span>
<span></span>
<span><span class="va">projList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"AOU"</span> <span class="op">=</span> <span class="va">oxygenSmooth</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">indices</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">indices</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>, </span>
<span>                 <span class="st">"Temperature"</span> <span class="op">=</span> <span class="va">temperature</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">indices</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">indices</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate MESS</span></span>
<span><span class="va">messBrick</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MESS3D.html">MESS3D</a></span><span class="op">(</span>calibration <span class="op">=</span> <span class="va">datForMod</span>, projection <span class="op">=</span> <span class="va">projList</span><span class="op">)</span></span></code></pre></div>
<p>Now I will calculate two <code>SpatRaster</code> objects. In the
first, <code>extrapolation</code>, MESS values zero and below
(i.e. signalling extrapolation) will be reclassified as 1, which will
allow me to easily map where extrapolation is occurring.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Reclassify MESS </span></span>
<span><span class="va">extrapolation</span> <span class="op">&lt;-</span> <span class="fl">0</span> <span class="op">&gt;=</span> <span class="va">messBrick</span></span>
<span></span>
<span><span class="co"># Plot Extrapolation</span></span>
<span><span class="fu"><a href="../reference/plotLayers.html">plotLayers</a></span><span class="op">(</span><span class="va">extrapolation</span>, land <span class="op">=</span> <span class="va">land</span>, landCol <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>           title <span class="op">=</span> <span class="st">"Areas of extrapolation according to MESS,\n 5m to 800m"</span><span class="op">)</span></span></code></pre></div>
<p><img src="e_GLMWorkflow_files/figure-html/reclassify%20and%20plot%20extrapolation-1.png"><!-- --></p>
<p>In the second <code>RasterBrick</code>, <code>noExtrapolation</code>,
I reclassify the layers so that positive MESS values = 1 and MESS values
less than or equal to 0 = 0. This will make plotting cropping out areas
of extrapolation from the niche model projection easier. I simply
multiply the thresholded GLM map by the <code>noExtrapolation</code>
<code>SpatRaster</code>.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Reclassify MESS </span></span>
<span><span class="va">noExtrapolation</span> <span class="op">&lt;-</span> <span class="va">messBrick</span> <span class="op">&gt;</span> <span class="fl">0</span></span>
<span></span>
<span><span class="va">glmThreshNoExtrapolation</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">nlyr</a></span><span class="op">(</span><span class="va">noExtrapolation</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">extrapCut</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">noExtrapolation</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">glmThresholded</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">croppedLayer</span> <span class="op">&lt;-</span> <span class="va">glmThresholded</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">*</span> <span class="va">extrapCut</span></span>
<span>  <span class="va">glmThreshNoExtrapolation</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">croppedLayer</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">glmThreshNoExtrapolation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">glmThreshNoExtrapolation</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot MESS</span></span>
<span><span class="fu"><a href="../reference/plotLayers.html">plotLayers</a></span><span class="op">(</span><span class="va">glmThreshNoExtrapolation</span>, land <span class="op">=</span> <span class="va">land</span>, </span>
<span>           landCol <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>           title <span class="op">=</span> <span class="st">"Areas of suitable habitat with no model extrapolation,\n 5m to 800m"</span><span class="op">)</span></span></code></pre></div>
<p><img src="e_GLMWorkflow_files/figure-html/reclassify%20MESS%20and%20plot%20GLM%20with%20no%20extrapolation-1.png"><!-- --></p>
</div>
<div class="section level2">
<h2 id="tidying-up">Tidying up<a class="anchor" aria-label="anchor" href="#tidying-up"></a>
</h2>
<p>Last, we need to close the temporary directory we opened when we
opened the data.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">td</span>, recursive <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Bakis Y (2021): TU_Fish. v1.1. No organization. Dataset/Occurrence.
<a href="https://bgnn.tulane.edu/ipt/resource?r=tu_fish&amp;v=1.1" class="external-link uri">https://bgnn.tulane.edu/ipt/resource?r=tu_fish&amp;v=1.1</a>
Accessed via OBIS on 2020-11-04.</p>
<p>Bentley A (2022). KUBI Ichthyology Collection. Version 17.80.
University of Kansas Biodiversity Institute. DOI: 10.15468/mgjasg.
Accessed via GBIF on 2020-10-13.</p>
<p>Bentley A (2022). KUBI Ichthyology Tissue Collection. Version 18.68.
University of Kansas Biodiversity Institute. DOI: 10.15468/jmsnwg.
Accessed via GBIF on 2020-10-13.</p>
<p>Buckup P A (2022). Coleção Ictiológica (MNRJ), Museu Nacional (MN),
Universidade Federal do Rio de Janeiro(UFRJ). Version 157.1487. Museu
Nacional / UFRJ. DOI: 10.15468/lluzfl. Accessed via GBIF on
2020-10-13.</p>
<p>Catania D, Fong J (2022). CAS Ichthyology (ICH). Version 150.300.
California Academy of Sciences. DOI: 10.15468/efh2ib. Accessed via GBIF
on 2020-10-13.</p>
<p>Chakrabarty P (2019). LSUMZ (LSU MNS) Fishes Collection. Version 2.2.
Louisiana State University Museum of Natural Science. DOI:
10.15468/gbnym3. Accessed via GBIF on 2020-10-13.</p>
<p>Chamberlain S, Barve V, Mcglinn D, Oldoni D, Desmet P, Geffert L, Ram
K (2021). rgbif: Interface to the Global Biodiversity Information
Facility API. R package version 3.6.0, <a href="https://CRAN.R-project.org/package=rgbif" class="external-link uri">https://CRAN.R-project.org/package=rgbif</a>.</p>
<p>Chamberlain S, Boettiger C (2017). “R Python, and Ruby clients for
GBIF species occurrence data.” <em>PeerJ</em> PrePrints. DOI:
10.7287/peerj.preprints.3304v1.</p>
<p>Davis Rabosky AR, Cox CL, Rabosky DL, Title PO, Holmes IA, Feldman A,
McGuire JA (2016). Coral snakes predict the evolution of mimicry across
New World snakes. <em>Nature Communications</em> 7:11484.</p>
<p>Elith J, Kearney M, Phillips S. 2010. The art of modelling
range-shifting species. <em>Methods in Ecology and Evolution</em>, 1,
330-342.</p>
<p>Espinosa Pérez H, Comisión nacional para el conocimiento y uso de la
biodiversidad C (2021). Computarización de la Colección Nacional de
Peces del Instituto de Biología UNAM. Version 1.9. Comisión nacional
para el conocimiento y uso de la biodiversidad. DOI: 10.15468/zb2odl.
Accessed via GBIF on 2020-10-13.</p>
<p>Frable B (2019). SIO Marine Vertebrate Collection. Version 1.7.
Scripps Institution of Oceanography. DOI: 10.15468/ad1ovc. Accessed via
GBIF on 2020-10-13.</p>
<p>Fishnet2 Portal, <a href="http://www.fishnet2.net" class="external-link uri">http://www.fishnet2.net</a>, [Access date] Accessed via OBIS
on 2020-11-04.</p>
<p>Froese, R. and D. Pauly. Editors. 200x. FishBase. World Wide Web
electronic publication. www.fishbase.org, version (xx/200x). Accessed
via OBIS on 2020-11-04.</p>
<p>Gall L (2021). Vertebrate Zoology Division - Ichthyology, Yale
Peabody Museum. Yale University Peabody Museum. DOI: 10.15468/mgyhok.
Accessed via GBIF on 2020-10-13.</p>
<p>García, CB, and Duarte, LO, ‘Columbian Caribbean Sea’, in J.H.
Nicholls (comp.) HMAP Data Pages <a href="https://oceanspast.org/hmap_db.php" class="external-link uri">https://oceanspast.org/hmap_db.php</a> Accessed via OBIS on
2020-11-04.</p>
<p>Garcia HE, Weathers K, Paver CR, Smolyar I, Boyer TP, Locarnini RA,
Zweng MM, Mishonov AV, Baranova OK, Seidov D, Reagan JR (2018). World
Ocean Atlas 2018, Volume 3: Dissolved Oxygen, Apparent Oxygen
Utilization, and Oxygen Saturation. A Mishonov Technical Ed.; NOAA Atlas
NESDIS 83, 38pp.</p>
<p>GBIF.org (24 September 2020) GBIF Occurrence Download DOI:
10.15468/dl.efuutj.</p>
<p>Grant S, McMahan C (2020). Field Museum of Natural History (Zoology)
Fish Collection. Version 13.12. Field Museum. DOI: 10.15468/alz7wu.
Accessed via GBIF on 2020-10-13.</p>
<p>Harvard University M, Morris P J (2022). Museum of Comparative
Zoology, Harvard University. Version 162.296. Museum of Comparative
Zoology, Harvard University. DOI: 10.15468/p5rupv. Accessed via GBIF on
2020-10-13.</p>
<p>Hendrickson D A, Cohen A E, Casarez M J (2022). University of Texas,
Biodiversity Center, Ichthyology Collection (TNHCi). Version 5.175.
University of Texas at Austin, Biodiversity Collections. DOI:
10.15468/h8gxdr. Accessed via GBIF on 2020-10-13.</p>
<p>INVEMAR. SIBM en línea: Sistema de Información sobre Biodiversidad
Marina. Santa Marta: Instituto de investigaciones Marinas y Costeras
José Benito Vives de Andréis,. <a href="http://www.invemar.org.co/siam/sibm/index.htm" class="external-link uri">http://www.invemar.org.co/siam/sibm/index.htm</a> Accessed
via OBIS on 2020-11-04.</p>
<p>Locarnini RA, Mishonov AV, Baranova OK, Boyer TP, Zweng MM, Garcia
HE, Reagan JR, Seidov D, Weathers K, Paver CR, Smolyar I (2018). World
Ocean Atlas 2018, Volume 1: Temperature. A. Mishonov Technical Ed.; NOAA
Atlas NESDIS 81, 52pp.</p>
<p>McLean, M.W. (2014). Straightforward Bibliography Management in R
Using the RefManager Package. NA, NA. <a href="https://arxiv.org/abs/1403.2036" class="external-link uri">https://arxiv.org/abs/1403.2036</a>.</p>
<p>McLean, M.W. (2017). RefManageR: Import and Manage BibTeX and
BibLaTeX References in R. <em>The Journal of Open Source
Software</em>.</p>
<p>Mertz W (2021). LACM Vertebrate Collection. Version 18.9. Natural
History Museum of Los Angeles County. DOI: 10.15468/77rmwd. Accessed via
GBIF on 2020-10-13.</p>
<p>Nakae M, Shinohara G (2018). Fish collection of National Museum of
Nature and Science. National Museum of Nature and Science, Japan.
Occurrence dataset DOI: 10.15468/w3dzv1 accessed via GBIF.org on
yyyy-mm-dd. Accessed via OBIS on 2020-11-04.</p>
<p>Natural History Museum (2021). Natural History Museum (London)
Collection Specimens. DOI: 10.5519/0002965. Accessed via GBIF on
2020-10-13.</p>
<p>National Museum of Natural History, Smithsonian Institution NMNH
Fishes Collection Database. National Museum of Natural History,
Smithsonian Institution, 10th and Constitution Ave. N.W., Washington, DC
20560-0193, 2007. Accessed via OBIS on 2020-11-04.</p>
<p>Norén M, Shah M (2017). Fishbase. FishBase. DOI: 10.15468/wk3zk7.
Accessed via GBIF on 2020-10-13.</p>
<p>Norton B, Hogue G (2021). NCSM Ichthyology Collection. Version 22.8.
North Carolina State Museum of Natural Sciences. DOI: 10.36102/dwc.1.
Accessed via GBIF on 2020-10-13.</p>
<p>Nychka D, Furrer R, Paige J, Sain S (2021). “fields: Tools for
spatial data.” R package version 13.3, &lt;URL: <a href="https://github.com/dnychka/fieldsRPackage" class="external-link uri">https://github.com/dnychka/fieldsRPackage</a>&gt;.</p>
<p>Orrell T, Informatics Office (2021). NMNH Extant Specimen Records
(USNM, US). Version 1.49. National Museum of Natural History,
Smithsonian Institution. DOI: 10.15468/hnhrg3. Accessed via GBIF on
2020-10-13.</p>
<p>Owens H, Campbell L, Dornak L, Saupe E, Barve N, Soberón J, Ingenloff
K, Lira-Noriega A, Hensz C, Myers, C, Peterson AT (2013). Constraints on
interpretation of ecological niche models by limited environmental
ranges on calibration areas. <em>Ecological Modelling</em> 263:
10-18.</p>
<p>Owens H, Merow C, Maitner B, Kass J, Barve V, Guralnick R (2021).
occCite: Querying and Managing Large Biodiversity Occurrence Datasets_.
doi: 10.5281/zenodo.4726676 (URL: DOI: 10.5281/zenodo.4726676), R
package version 0.4.9.9000, (&lt;URL: <a href="https://CRAN.R-project.org/package=occCite" class="external-link uri">https://CRAN.R-project.org/package=occCite</a>&gt;).</p>
<p>Prestridge H (2021). Biodiversity Research and Teaching Collections -
TCWC Vertebrates. Version 9.4. Texas A&amp;M University Biodiversity
Research and Teaching Collections. DOI: 10.15468/szomia. Accessed via
GBIF on 2020-10-13.</p>
<p>Provoost P, Bosch S (2019). “robis: R Client to access data from the
OBIS API.” Ocean Biogeographic Information System. Intergovernmental
Oceanographic Commission of UNESCO. R package version 2.1.8, <a href="https://cran.r-project.org/package=robis" class="external-link uri">https://cran.r-project.org/package=robis</a>.</p>
<p>Pugh W (2021). UAIC Ichthyological Collection. Version 3.3.
University of Alabama Biodiversity and Systematics. DOI:
10.15468/a2laag. Accessed via GBIF on 2020-10-13.</p>
<p>R Core Team (2017). R: A language and environment for statistical
computing. R Foundation for Statistical Computing, Vienna, Austria. URL
<a href="https://www.R-project.org/" class="external-link uri">https://www.R-project.org/</a>.</p>
<p>Robins R (2021). UF FLMNH Ichthyology. Version 117.342. Florida
Museum of Natural History. DOI: 10.15468/8mjsel. Accessed via GBIF on
2020-10-13.</p>
<p>Tavera L, Tavera M. L (2021). Biodiversidad de los recursos marinos y
costeros entre Cartagena y el Golfo de Urabá, Caribe colombiano. Version
2.4. Instituto de Investigaciones Marinas y Costeras - Invemar. DOI:
10.15472/d2jusp. Accessed via GBIF on 2020-10-13.</p>
<p>UNIBIO, IBUNAM. CNPE/Coleccion Nacional de Peces. DOI:
10.15468/o5d48z. Accessed via GBIF on 2020-10-13.</p>
<p>Wagner M (2017). MMNS Ichthyology Collection. Mississippi Museum of
Natural Science. DOI: 10.15468/4c3qeq. Accessed via GBIF on
2020-10-13.</p>
<p>Werneke D (2019). AUM Fish Collection. Version 8.1. Auburn University
Museum. DOI: 10.15468/dm3oyz. Accessed via GBIF on 2020-10-13.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Hannah L. Owens, Carsten Rahbek.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
